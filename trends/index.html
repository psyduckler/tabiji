<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Destination Trends | tabiji.ai</title>
<meta name="description" content="Track which travel destinations are trending up or down. Real-time search interest data for 50+ destinations.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--indigo:#2D3A5C;--indigo-light:#3D4E7A;--terracotta:#c4704b;--cream:#F5F0E8;--sand:#E8DFD0;--earth:#8B7355;--white:#FEFCF9;--text:#2C2419;--text-muted:#6B5D4F;--dark:#2C2419;--light-text:#6B5D4F;--green:#3a7d5c;--red:#c44b4b}
body{font-family:'Inter',sans-serif;background:var(--cream);color:var(--dark);min-height:100vh}

/* Nav */
nav{position:fixed;top:0;width:100%;z-index:100;background:rgba(254,252,249,0.92);backdrop-filter:blur(20px);border-bottom:1px solid var(--sand);padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center}
.logo{font-size:1.4rem;font-weight:700;color:var(--indigo);text-decoration:none;letter-spacing:-0.02em}
.logo span{color:var(--terracotta)}
nav a.cta-nav{background:var(--terracotta);color:white;padding:0.5rem 1.2rem;border-radius:8px;text-decoration:none;font-size:0.9rem;font-weight:500;transition:background 0.2s}
nav a.cta-nav:hover{background:#b5633f}
.nav-links{display:flex;gap:1.5rem;align-items:center}
.nav-link{color:var(--indigo);text-decoration:none;font-size:0.9rem;font-weight:500}
.hamburger{display:none;background:none;border:none;font-size:1.5rem;color:var(--indigo);cursor:pointer}

/* Header */
.header{text-align:center;padding:100px 20px 0}
h1{font-family:'Playfair Display',serif;font-size:clamp(1.8rem,5vw,2.8rem);color:var(--indigo);margin:10px 0 4px;line-height:1.15}
.subtitle{color:var(--light-text);font-size:0.95rem}

/* Filters */
.filters{max-width:900px;margin:28px auto 0;padding:0 20px;display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:center}
.search-box{background:#fff;border:2px solid var(--sand);border-radius:50px;padding:10px 18px;color:var(--dark);font-size:0.9rem;width:220px;outline:none;font-family:'Inter',sans-serif;transition:border-color .15s}
.search-box:focus{border-color:var(--indigo)}
.search-box::placeholder{color:var(--light-text)}
.chips{display:flex;flex-wrap:wrap;gap:8px}
.chip{padding:8px 16px;border-radius:50px;border:2px solid var(--sand);background:#fff;font-size:0.88rem;font-weight:500;cursor:pointer;transition:all .15s;font-family:'Inter',sans-serif;color:var(--dark);user-select:none}
.chip:hover{border-color:var(--indigo);background:#f0f4fa}
.chip.active{background:var(--indigo);color:#fff;border-color:var(--indigo)}

/* Table */
.table-wrap{max-width:1080px;margin:24px auto 60px;padding:0 20px;overflow-x:auto}
table{width:100%;border-collapse:collapse;background:#fff;border-radius:16px;overflow:hidden;box-shadow:0 4px 20px rgba(0,0,0,.07)}
thead th{text-align:left;padding:14px 18px;color:var(--light-text);font-weight:600;font-size:0.78rem;text-transform:uppercase;letter-spacing:0.05em;border-bottom:2px solid var(--sand);cursor:pointer;user-select:none;white-space:nowrap;background:var(--white)}
thead th:hover{color:var(--indigo)}
thead th .sort-arrow{margin-left:4px;font-size:0.7rem}
tbody tr{border-bottom:1px solid #f0ece4;transition:background 0.1s;cursor:pointer}
tbody tr:hover{background:#faf7f2}
tbody tr:last-child{border-bottom:none}
td{padding:14px 18px;font-size:0.95rem}
td.rank{color:var(--light-text);font-size:0.85rem;width:40px}
td.name{font-family:'Playfair Display',serif;font-weight:700;color:var(--indigo);font-size:1rem}
td.num{text-align:right;font-variant-numeric:tabular-nums}
.velocity-badge{font-weight:700;font-size:0.9rem;padding:4px 12px;border-radius:50px;display:inline-block}
.velocity-badge.up{color:var(--green);background:rgba(58,125,92,0.1)}
.velocity-badge.down{color:var(--red);background:rgba(196,75,75,0.1)}
.velocity-badge.flat{color:var(--light-text);background:rgba(107,93,79,0.08)}
.sparkline{width:120px;height:32px}
.trend-label{font-size:0.8rem;font-weight:600;padding:4px 10px;border-radius:50px}
.trend-label.rising{color:var(--green);background:rgba(58,125,92,0.08)}
.trend-label.falling{color:var(--red);background:rgba(196,75,75,0.08)}
.trend-label.steady{color:var(--light-text);background:rgba(107,93,79,0.06)}

.no-results{text-align:center;padding:60px 20px;color:var(--light-text);font-size:0.95rem}
#loading{text-align:center;color:var(--light-text);padding:4rem;font-size:0.95rem}

/* Modal */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:200;align-items:center;justify-content:center;padding:20px}
.modal-overlay.show{display:flex}
.modal{background:#fff;border-radius:20px;max-width:500px;width:100%;max-height:90vh;overflow-y:auto;position:relative}
.modal img.modal-img{width:100%;height:280px;object-fit:cover;border-radius:20px 20px 0 0}
.modal .card-body{padding:24px}
.modal .card-body h2{font-family:'Playfair Display',serif;font-size:1.5rem;color:var(--indigo);margin-bottom:2px}
.modal .region{color:var(--light-text);font-size:0.8rem;margin-bottom:10px}
.modal .pitch{font-size:0.9rem;line-height:1.55;color:#444;margin-bottom:12px}
.modal .tags{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:12px}
.modal .tag{padding:4px 10px;border-radius:16px;font-size:0.72rem;font-weight:600;background:#eef2ff;color:var(--indigo)}
.modal .card-meta{display:flex;gap:14px;font-size:0.8rem;color:var(--light-text);margin-bottom:4px}
.modal-close{position:absolute;top:12px;right:12px;width:36px;height:36px;border-radius:50%;background:rgba(0,0,0,.5);border:none;color:#fff;font-size:1.2rem;cursor:pointer;display:flex;align-items:center;justify-content:center}
.modal-close:hover{background:rgba(0,0,0,.7)}
.card-cta{display:inline-block;margin-top:12px;padding:10px 24px;border-radius:50px;background:var(--indigo);color:#fff;text-decoration:none;font-size:0.9rem;font-weight:600;transition:all .2s}
.card-cta:hover{background:#2a4a7a}

footer{padding:3rem 2rem;text-align:center;border-top:1px solid var(--sand);color:var(--light-text);font-size:0.85rem}

@media(max-width:768px){
  nav{padding:0.8rem 1.2rem}
  .hamburger{display:block}
  .nav-links{display:none;position:absolute;top:100%;left:0;right:0;background:rgba(254,252,249,0.98);backdrop-filter:blur(20px);border-bottom:1px solid var(--sand);padding:1rem 1.5rem;flex-direction:column;gap:1rem}
  .nav-links.open{display:flex}
  .search-box{width:100%}
  td,th{padding:10px 10px}
  .sparkline{width:80px}
  .hide-mobile{display:none}
  .header{padding-top:80px}
}
</style>
</head>
<body>

<nav>
  <a href="/" class="logo"><img src="/logo-kanji-only.png" alt="tabiji.ai" style="height:32px;vertical-align:middle;margin-right:6px;">tabiji<span>.ai</span></a>
  <button class="hamburger" onclick="document.querySelector('.nav-links').classList.toggle('open')" aria-label="Menu">‚ò∞</button>
  <div class="nav-links">
    <a href="/find/" class="nav-link">Explore</a>
    <a href="/itineraries/" class="nav-link">Sample Itineraries</a>
    <a href="/popular-picks/" class="nav-link">Popular Picks</a>
    <a href="/trends/" class="nav-link" style="color:var(--terracotta)">Trends</a>
    <a href="/about/" class="nav-link">About</a>
    <a href="/plan" class="cta-nav">Get Your Free Custom Itinerary</a>
  </div>
</nav>

<div class="header">
  <h1>üìä Destination Trends</h1>
  <p class="subtitle">Interest over the last 12 months ¬∑ Updated <span id="updated"></span></p>
</div>

<div style="background: linear-gradient(135deg, #F5F0E8, #E8DFD0); border-radius: 12px; padding: 24px 28px; margin: 0 auto 24px; max-width: 900px; border-left: 4px solid #C4704B;">
  <div style="font-weight: 700; color: #2D3A5C; font-size: 1rem; margin-bottom: 8px;">üìä How we analyzed trends</div>
  <p style="margin: 0; color: #3E2F23; line-height: 1.7; font-size: 0.95rem;">
    We track <strong>Google search interest</strong> for 50 popular travel destinations over the last 12 months using the Google Trends API. Each destination is scored 0‚Äì100 relative to its own peak popularity. The <strong>1-year change</strong> compares current interest to the same period last year ‚Äî rising destinations are gaining search momentum, falling ones are cooling off. Data updates weekly.
  </p>
</div>

<div class="filters">
  <input type="text" class="search-box" id="search" placeholder="Search destinations‚Ä¶">
  <div class="chips" id="trend-filter">
    <button class="chip active" data-filter="all">All</button>
    <button class="chip" data-filter="rising">üî• Rising</button>
    <button class="chip" data-filter="falling">üìâ Falling</button>
    <button class="chip" data-filter="steady">‚û°Ô∏è Steady</button>
  </div>
</div>

<div id="loading">Loading trends data‚Ä¶</div>

<div class="table-wrap">
<table id="table" style="display:none">
  <thead>
    <tr>
      <th data-sort="rank"># <span class="sort-arrow"></span></th>
      <th data-sort="name">Destination <span class="sort-arrow"></span></th>
      <th data-sort="current" style="text-align:right">Current <span class="sort-arrow"></span></th>
      <th data-sort="peak" style="text-align:right" class="hide-mobile">Peak <span class="sort-arrow"></span></th>
      <th data-sort="velocity" style="text-align:right">1Y Change <span class="sort-arrow"></span></th>
      <th>Trend</th>
      <th class="hide-mobile">Last 12 Months</th>
    </tr>
  </thead>
  <tbody id="tbody"></tbody>
</table>
</div>
<div id="no-results" class="no-results" style="display:none">No destinations match your filters.</div>

<!-- Modal -->
<div class="modal-overlay" id="modal" onclick="if(event.target===this)closeModal()">
  <div class="modal">
    <button class="modal-close" onclick="closeModal()">‚úï</button>
    <img class="modal-img" id="mImg" src="" alt="">
    <div class="card-body">
      <h2 id="mName"></h2>
      <div class="region" id="mRegion"></div>
      <p class="pitch" id="mPitch"></p>
      <div class="tags" id="mTags"></div>
      <div class="card-meta">
        <span id="mSeason"></span>
      </div>
      <a class="card-cta" id="mCta" href="#">Plan this trip ‚Üí</a>
    </div>
  </div>
</div>

<footer>
  <p>¬© 2026 tabiji.ai ¬∑ <a href="/terms/" style="color:inherit;text-decoration:underline">Terms</a> ¬∑ <a href="/privacy/" style="color:inherit;text-decoration:underline">Privacy</a> ¬∑ <a href="/delete-data/" style="color:inherit;text-decoration:underline">Delete My Data</a> ¬∑ <a href="https://www.instagram.com/tabiji.ai/" target="_blank" rel="noopener" style="color:inherit;text-decoration:underline">Instagram</a></p>
</footer>

<!-- GA4 -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-D7QHNRXLHJ"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-D7QHNRXLHJ');</script>

<script>
let allDests = [];
let sortCol = 'velocity';
let sortDir = -1;

function sparkline(values, color) {
  const w = 120, h = 28;
  const max = Math.max(...values, 1), min = Math.min(...values, 0);
  const range = max - min || 1;
  const pts = values.map((v, i) => `${(i / (values.length - 1)) * w},${h - ((v - min) / range) * (h - 4) - 2}`).join(' ');
  return `<svg class="sparkline" viewBox="0 0 ${w} ${h}" preserveAspectRatio="none"><polyline points="${pts}" fill="none" stroke="${color}" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
}

let destInfo = {}; // keyed by lowercase name from destinations.json

function photoUrl(p, w, q) {
  if (!p) return '';
  if (p.startsWith('http')) return p;
  if (p.startsWith('img/')) return '/find/' + p;
  return `https://images.unsplash.com/${p}?w=${w}&q=${q}&auto=format&fit=crop`;
}

function calcVelocity(values) {
  if (values.length < 8) return 0;
  const recent = values.slice(-4).reduce((a, b) => a + b, 0) / 4;
  const earliest = values.slice(0, 4).reduce((a, b) => a + b, 0) / 4;
  if (earliest === 0) return recent > 0 ? 100 : 0;
  return ((recent - earliest) / earliest) * 100;
}

function trendClass(v) { return v > 5 ? 'rising' : v < -5 ? 'falling' : 'steady'; }

function render() {
  const search = document.getElementById('search').value.toLowerCase();
  const filter = document.querySelector('#trend-filter .chip.active').dataset.filter;

  let filtered = allDests.filter(d => {
    if (search && !d.destination.toLowerCase().includes(search)) return false;
    if (filter !== 'all' && d.trend !== filter) return false;
    return true;
  });

  filtered.sort((a, b) => {
    let va, vb;
    if (sortCol === 'name') { va = a.destination; vb = b.destination; return sortDir * va.localeCompare(vb); }
    if (sortCol === 'rank') { va = a.rank; vb = b.rank; }
    else if (sortCol === 'current') { va = a.current; vb = b.current; }
    else if (sortCol === 'peak') { va = a.peak; vb = b.peak; }
    else if (sortCol === 'velocity') { va = a.velocity; vb = b.velocity; }
    return sortDir * ((va || 0) - (vb || 0));
  });

  const tbody = document.getElementById('tbody');
  if (filtered.length === 0) {
    tbody.innerHTML = '';
    document.getElementById('no-results').style.display = 'block';
    return;
  }
  document.getElementById('no-results').style.display = 'none';

  tbody.innerHTML = filtered.map((d) => {
    const vClass = d.velocity > 5 ? 'up' : d.velocity < -5 ? 'down' : 'flat';
    const vSign = d.velocity > 0 ? '+' : '';
    const color = d.velocity > 5 ? '#3a7d5c' : d.velocity < -5 ? '#c44b4b' : '#8B7355';
    return `<tr onclick="openModal('${d.destination.replace(/'/g,"\\'")}')">
      <td class="rank">${d.rank}</td>
      <td class="name">${d.destination}</td>
      <td class="num">${d.current}</td>
      <td class="num hide-mobile">${d.peak}</td>
      <td class="num"><span class="velocity-badge ${vClass}">${vSign}${d.velocity.toFixed(1)}%</span></td>
      <td><span class="trend-label ${d.trend}">${d.trend === 'rising' ? 'üî• Rising' : d.trend === 'falling' ? 'üìâ Falling' : '‚û°Ô∏è Steady'}</span></td>
      <td class="hide-mobile">${sparkline(d.values, color)}</td>
    </tr>`;
  }).join('');
}

// Sort
document.querySelectorAll('thead th[data-sort]').forEach(th => {
  th.addEventListener('click', () => {
    const col = th.dataset.sort;
    if (sortCol === col) sortDir *= -1;
    else { sortCol = col; sortDir = col === 'name' ? 1 : -1; }
    document.querySelectorAll('thead th .sort-arrow').forEach(s => s.textContent = '');
    th.querySelector('.sort-arrow').textContent = sortDir === 1 ? '‚ñ≤' : '‚ñº';
    render();
  });
});

// Filter chips
document.querySelectorAll('#trend-filter .chip').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('#trend-filter .chip').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    render();
  });
});

document.getElementById('search').addEventListener('input', render);

// Modal
function openModal(destName) {
  const d = allDests.find(x => x.destination === destName);
  if (!d) return;
  const info = destInfo[d.rawName.toLowerCase()] || destInfo[d.destination.toLowerCase()] || null;
  const img = document.getElementById('mImg');
  if (info && info.photo) {
    img.src = photoUrl(info.photo, 800, 80);
    img.alt = info.name;
    img.style.display = 'block';
  } else {
    img.style.display = 'none';
  }
  document.getElementById('mName').textContent = info ? info.name : d.destination;
  document.getElementById('mRegion').textContent = info ? info.region : (d.rawName !== d.destination ? d.destination.split(', ').pop() : '');
  document.getElementById('mPitch').textContent = info ? info.pitch : '';
  const tags = document.getElementById('mTags');
  if (info && info.vibes) {
    tags.innerHTML = info.vibes.map(v => `<span class="tag">${v}</span>`).join('');
  } else {
    tags.innerHTML = '';
  }
  document.getElementById('mSeason').textContent = info && info.season ? 'üìÖ ' + info.season : '';
  document.getElementById('mCta').href = `/plan.html?destination=${encodeURIComponent(d.rawName)}`;
  document.getElementById('modal').classList.add('show');
  document.body.style.overflow = 'hidden';
}

function closeModal() {
  document.getElementById('modal').classList.remove('show');
  document.body.style.overflow = '';
}

document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

// Load destination info from /find for modal photos/pitches
fetch('/find/destinations.json')
  .then(r => r.json())
  .then(dests => { dests.forEach(d => { destInfo[d.name.toLowerCase()] = d; }); })
  .catch(() => {});

// Load trends
fetch('trends-data.json')
  .then(r => r.json())
  .then(data => {
    document.getElementById('updated').textContent = new Date(data.updated).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    allDests = data.destinations.map((d, i) => {
      const velocity = calcVelocity(d.values);
      return {
        rank: i + 1,
        destination: d.country && d.country !== d.destination ? `${d.destination}, ${d.country}` : d.destination,
        rawName: d.destination,
        values: d.values,
        dates: d.dates || [],
        current: d.values[d.values.length - 1] || 0,
        peak: Math.max(...d.values),
        velocity,
        trend: trendClass(velocity),
      };
    });
    allDests.sort((a, b) => b.velocity - a.velocity);
    allDests.forEach((d, i) => d.rank = i + 1);
    document.getElementById('loading').style.display = 'none';
    document.getElementById('table').style.display = 'table';
    document.querySelector('th[data-sort="velocity"] .sort-arrow').textContent = '‚ñº';
    render();
  });
</script>
</body>
</html>
