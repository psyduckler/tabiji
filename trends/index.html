<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Destination Trends | tabiji.ai</title>
<meta name="description" content="Track which travel destinations are trending up or down. Real-time search interest data for 50+ destinations.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--indigo:#2D3A5C;--indigo-light:#3D4E7A;--terracotta:#c4704b;--cream:#F5F0E8;--sand:#E8DFD0;--earth:#8B7355;--white:#FEFCF9;--text:#2C2419;--text-muted:#6B5D4F;--dark:#2C2419;--light-text:#6B5D4F;--green:#3a7d5c;--red:#c44b4b}
body{font-family:'Inter',sans-serif;background:var(--cream);color:var(--dark);min-height:100vh}

/* Nav */
nav{position:fixed;top:0;width:100%;z-index:100;background:rgba(254,252,249,0.92);backdrop-filter:blur(20px);border-bottom:1px solid var(--sand);padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center}
.logo{font-size:1.4rem;font-weight:700;color:var(--indigo);text-decoration:none;letter-spacing:-0.02em}
.logo span{color:var(--terracotta)}
nav a.cta-nav{background:var(--terracotta);color:white;padding:0.5rem 1.2rem;border-radius:8px;text-decoration:none;font-size:0.9rem;font-weight:500;transition:background 0.2s}
nav a.cta-nav:hover{background:#b5633f}
.nav-links{display:flex;gap:1.5rem;align-items:center}
.nav-link{color:var(--indigo);text-decoration:none;font-size:0.9rem;font-weight:500}
.hamburger{display:none;background:none;border:none;font-size:1.5rem;color:var(--indigo);cursor:pointer}

/* Header */
.header{text-align:center;padding:100px 20px 0}
h1{font-family:'Playfair Display',serif;font-size:clamp(1.8rem,5vw,2.8rem);color:var(--indigo);margin:10px 0 4px;line-height:1.15}
.subtitle{color:var(--light-text);font-size:0.95rem}

/* Filters */
.filters{max-width:900px;margin:28px auto 0;padding:0 20px;display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:center}
.search-box{background:#fff;border:2px solid var(--sand);border-radius:50px;padding:10px 18px;color:var(--dark);font-size:0.9rem;width:220px;outline:none;font-family:'Inter',sans-serif;transition:border-color .15s}
.search-box:focus{border-color:var(--indigo)}
.search-box::placeholder{color:var(--light-text)}
.chips{display:flex;flex-wrap:wrap;gap:8px}
.chip{padding:8px 16px;border-radius:50px;border:2px solid var(--sand);background:#fff;font-size:0.88rem;font-weight:500;cursor:pointer;transition:all .15s;font-family:'Inter',sans-serif;color:var(--dark);user-select:none}
.chip:hover{border-color:var(--indigo);background:#f0f4fa}
.chip.active{background:var(--indigo);color:#fff;border-color:var(--indigo)}

/* Table */
.table-wrap{max-width:1080px;margin:24px auto 60px;padding:0 20px;overflow-x:auto}
table{width:100%;border-collapse:collapse;background:#fff;border-radius:16px;overflow:hidden;box-shadow:0 4px 20px rgba(0,0,0,.07)}
thead th{text-align:left;padding:14px 18px;color:var(--light-text);font-weight:600;font-size:0.78rem;text-transform:uppercase;letter-spacing:0.05em;border-bottom:2px solid var(--sand);cursor:pointer;user-select:none;white-space:nowrap;background:var(--white)}
thead th:hover{color:var(--indigo)}
thead th .sort-arrow{margin-left:4px;font-size:0.7rem}
tbody tr{border-bottom:1px solid #f0ece4;transition:background 0.1s;cursor:pointer}
tbody tr:hover{background:#faf7f2}
tbody tr:last-child{border-bottom:none}
td{padding:14px 18px;font-size:0.95rem}
td.rank{color:var(--light-text);font-size:0.85rem;width:40px}
td.name{font-family:'Playfair Display',serif;font-weight:700;color:var(--indigo);font-size:1rem}
td.num{text-align:right;font-variant-numeric:tabular-nums}
.velocity-badge{font-weight:700;font-size:0.9rem;padding:4px 12px;border-radius:50px;display:inline-block}
.velocity-badge.up{color:var(--green);background:rgba(58,125,92,0.1)}
.velocity-badge.down{color:var(--red);background:rgba(196,75,75,0.1)}
.velocity-badge.flat{color:var(--light-text);background:rgba(107,93,79,0.08)}
.sparkline{width:120px;height:32px}
.trend-label{font-size:0.8rem;font-weight:600;padding:4px 10px;border-radius:50px}
.trend-label.rising{color:var(--green);background:rgba(58,125,92,0.08)}
.trend-label.falling{color:var(--red);background:rgba(196,75,75,0.08)}
.trend-label.steady{color:var(--light-text);background:rgba(107,93,79,0.06)}

.no-results{text-align:center;padding:60px 20px;color:var(--light-text);font-size:0.95rem}
#loading{text-align:center;color:var(--light-text);padding:4rem;font-size:0.95rem}

/* Modal */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:200;align-items:center;justify-content:center;padding:20px}
.modal-overlay.show{display:flex}
.modal{background:#fff;border-radius:20px;max-width:520px;width:100%;max-height:90vh;overflow-y:auto;position:relative;padding:32px}
.modal-close{position:absolute;top:14px;right:14px;width:34px;height:34px;border-radius:50%;background:var(--sand);border:none;color:var(--dark);font-size:1.1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background .15s}
.modal-close:hover{background:#d9d0c1}
.modal h2{font-family:'Playfair Display',serif;font-size:1.5rem;color:var(--indigo);margin-bottom:6px}
.modal .modal-trend{margin-bottom:16px}
.modal .modal-chart{margin:16px 0 4px}
.modal .modal-chart svg{width:100%;height:120px}
.modal .modal-dates{font-size:0.78rem;color:var(--light-text);display:flex;justify-content:space-between;margin-bottom:16px}
.modal .modal-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:16px 0}
.modal .stat-box{background:var(--cream);border-radius:12px;padding:16px;text-align:center}
.modal .stat-box .stat-label{font-size:0.72rem;color:var(--light-text);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:4px;font-weight:600}
.modal .stat-box .stat-value{font-size:1.3rem;font-weight:700;font-variant-numeric:tabular-nums;color:var(--indigo)}
.modal .modal-cta{display:block;text-align:center;background:var(--terracotta);color:#fff;padding:14px;border-radius:50px;font-weight:600;font-size:0.95rem;margin-top:20px;text-decoration:none;transition:background 0.2s}
.modal .modal-cta:hover{background:#b5633f}

footer{padding:3rem 2rem;text-align:center;border-top:1px solid var(--sand);color:var(--light-text);font-size:0.85rem}

@media(max-width:768px){
  nav{padding:0.8rem 1.2rem}
  .hamburger{display:block}
  .nav-links{display:none;position:absolute;top:100%;left:0;right:0;background:rgba(254,252,249,0.98);backdrop-filter:blur(20px);border-bottom:1px solid var(--sand);padding:1rem 1.5rem;flex-direction:column;gap:1rem}
  .nav-links.open{display:flex}
  .search-box{width:100%}
  td,th{padding:10px 10px}
  .sparkline{width:80px}
  .hide-mobile{display:none}
  .header{padding-top:80px}
}
</style>
</head>
<body>

<nav>
  <a href="/" class="logo"><img src="/logo-kanji-only.png" alt="tabiji.ai" style="height:32px;vertical-align:middle;margin-right:6px;">tabiji<span>.ai</span></a>
  <button class="hamburger" onclick="document.querySelector('.nav-links').classList.toggle('open')" aria-label="Menu">‚ò∞</button>
  <div class="nav-links">
    <a href="/find/" class="nav-link">Explore</a>
    <a href="/itineraries/" class="nav-link">Sample Itineraries</a>
    <a href="/popular-picks/" class="nav-link">Popular Picks</a>
    <a href="/trends/" class="nav-link" style="color:var(--terracotta)">Trends</a>
    <a href="/about/" class="nav-link">About</a>
    <a href="/plan" class="cta-nav">Get Your Free Custom Itinerary</a>
  </div>
</nav>

<div class="header">
  <h1>üìä Destination Trends</h1>
  <p class="subtitle">Search interest over the last 12 months ¬∑ Updated <span id="updated"></span></p>
</div>

<div class="filters">
  <input type="text" class="search-box" id="search" placeholder="Search destinations‚Ä¶">
  <div class="chips" id="trend-filter">
    <button class="chip active" data-filter="all">All</button>
    <button class="chip" data-filter="rising">üî• Rising</button>
    <button class="chip" data-filter="falling">üìâ Falling</button>
    <button class="chip" data-filter="steady">‚û°Ô∏è Steady</button>
  </div>
</div>

<div id="loading">Loading trends data‚Ä¶</div>

<div class="table-wrap">
<table id="table" style="display:none">
  <thead>
    <tr>
      <th data-sort="rank"># <span class="sort-arrow"></span></th>
      <th data-sort="name">Destination <span class="sort-arrow"></span></th>
      <th data-sort="current" style="text-align:right">Current <span class="sort-arrow"></span></th>
      <th data-sort="peak" style="text-align:right" class="hide-mobile">Peak <span class="sort-arrow"></span></th>
      <th data-sort="velocity" style="text-align:right">1Y Change <span class="sort-arrow"></span></th>
      <th>Trend</th>
      <th class="hide-mobile">Last 12 Months</th>
    </tr>
  </thead>
  <tbody id="tbody"></tbody>
</table>
</div>
<div id="no-results" class="no-results" style="display:none">No destinations match your filters.</div>

<!-- Modal -->
<div class="modal-overlay" id="modal" onclick="if(event.target===this)closeModal()">
  <div class="modal">
    <button class="modal-close" onclick="closeModal()">‚úï</button>
    <h2 id="mName"></h2>
    <div class="modal-trend" id="mTrend"></div>
    <div class="modal-chart" id="mChart"></div>
    <div class="modal-dates"><span id="mDateStart"></span><span id="mDateEnd"></span></div>
    <div class="modal-stats">
      <div class="stat-box"><div class="stat-label">Current</div><div class="stat-value" id="mCurrent"></div></div>
      <div class="stat-box"><div class="stat-label">Peak</div><div class="stat-value" id="mPeak"></div></div>
      <div class="stat-box"><div class="stat-label">1Y Change</div><div class="stat-value" id="mChange"></div></div>
    </div>
    <a class="modal-cta" id="mCta" href="#">Plan this trip ‚Üí</a>
  </div>
</div>

<footer>
  <p>¬© 2026 tabiji.ai ¬∑ <a href="/terms/" style="color:inherit;text-decoration:underline">Terms</a> ¬∑ <a href="/privacy/" style="color:inherit;text-decoration:underline">Privacy</a> ¬∑ <a href="/delete-data/" style="color:inherit;text-decoration:underline">Delete My Data</a> ¬∑ <a href="https://www.instagram.com/tabiji.ai/" target="_blank" rel="noopener" style="color:inherit;text-decoration:underline">Instagram</a></p>
</footer>

<!-- GA4 -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-D7QHNRXLHJ"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-D7QHNRXLHJ');</script>

<script>
let allDests = [];
let sortCol = 'velocity';
let sortDir = -1;

function sparkline(values, color) {
  const w = 120, h = 28;
  const max = Math.max(...values, 1), min = Math.min(...values, 0);
  const range = max - min || 1;
  const pts = values.map((v, i) => `${(i / (values.length - 1)) * w},${h - ((v - min) / range) * (h - 4) - 2}`).join(' ');
  return `<svg class="sparkline" viewBox="0 0 ${w} ${h}" preserveAspectRatio="none"><polyline points="${pts}" fill="none" stroke="${color}" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
}

function bigSparkline(values, color) {
  const w = 460, h = 110;
  const max = Math.max(...values, 1), min = Math.min(...values, 0);
  const range = max - min || 1;
  const pts = values.map((v, i) => `${(i / (values.length - 1)) * w},${h - ((v - min) / range) * (h - 8) - 4}`).join(' ');
  const fillPts = pts + ` ${w},${h} 0,${h}`;
  const gid = 'g' + Math.random().toString(36).slice(2,8);
  return `<svg viewBox="0 0 ${w} ${h}" preserveAspectRatio="none">
    <defs><linearGradient id="${gid}" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="${color}" stop-opacity="0.15"/><stop offset="100%" stop-color="${color}" stop-opacity="0"/></linearGradient></defs>
    <polygon points="${fillPts}" fill="url(#${gid})"/>
    <polyline points="${pts}" fill="none" stroke="${color}" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>`;
}

function calcVelocity(values) {
  if (values.length < 8) return 0;
  const recent = values.slice(-4).reduce((a, b) => a + b, 0) / 4;
  const earliest = values.slice(0, 4).reduce((a, b) => a + b, 0) / 4;
  if (earliest === 0) return recent > 0 ? 100 : 0;
  return ((recent - earliest) / earliest) * 100;
}

function trendClass(v) { return v > 5 ? 'rising' : v < -5 ? 'falling' : 'steady'; }

function render() {
  const search = document.getElementById('search').value.toLowerCase();
  const filter = document.querySelector('#trend-filter .chip.active').dataset.filter;

  let filtered = allDests.filter(d => {
    if (search && !d.destination.toLowerCase().includes(search)) return false;
    if (filter !== 'all' && d.trend !== filter) return false;
    return true;
  });

  filtered.sort((a, b) => {
    let va, vb;
    if (sortCol === 'name') { va = a.destination; vb = b.destination; return sortDir * va.localeCompare(vb); }
    if (sortCol === 'rank') { va = a.rank; vb = b.rank; }
    else if (sortCol === 'current') { va = a.current; vb = b.current; }
    else if (sortCol === 'peak') { va = a.peak; vb = b.peak; }
    else if (sortCol === 'velocity') { va = a.velocity; vb = b.velocity; }
    return sortDir * ((va || 0) - (vb || 0));
  });

  const tbody = document.getElementById('tbody');
  if (filtered.length === 0) {
    tbody.innerHTML = '';
    document.getElementById('no-results').style.display = 'block';
    return;
  }
  document.getElementById('no-results').style.display = 'none';

  tbody.innerHTML = filtered.map((d) => {
    const vClass = d.velocity > 5 ? 'up' : d.velocity < -5 ? 'down' : 'flat';
    const vSign = d.velocity > 0 ? '+' : '';
    const color = d.velocity > 5 ? '#3a7d5c' : d.velocity < -5 ? '#c44b4b' : '#8B7355';
    return `<tr onclick="openModal('${d.destination.replace(/'/g,"\\'")}')">
      <td class="rank">${d.rank}</td>
      <td class="name">${d.destination}</td>
      <td class="num">${d.current}</td>
      <td class="num hide-mobile">${d.peak}</td>
      <td class="num"><span class="velocity-badge ${vClass}">${vSign}${d.velocity.toFixed(1)}%</span></td>
      <td><span class="trend-label ${d.trend}">${d.trend === 'rising' ? 'üî• Rising' : d.trend === 'falling' ? 'üìâ Falling' : '‚û°Ô∏è Steady'}</span></td>
      <td class="hide-mobile">${sparkline(d.values, color)}</td>
    </tr>`;
  }).join('');
}

// Sort
document.querySelectorAll('thead th[data-sort]').forEach(th => {
  th.addEventListener('click', () => {
    const col = th.dataset.sort;
    if (sortCol === col) sortDir *= -1;
    else { sortCol = col; sortDir = col === 'name' ? 1 : -1; }
    document.querySelectorAll('thead th .sort-arrow').forEach(s => s.textContent = '');
    th.querySelector('.sort-arrow').textContent = sortDir === 1 ? '‚ñ≤' : '‚ñº';
    render();
  });
});

// Filter chips
document.querySelectorAll('#trend-filter .chip').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('#trend-filter .chip').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    render();
  });
});

document.getElementById('search').addEventListener('input', render);

// Modal
function openModal(destName) {
  const d = allDests.find(x => x.destination === destName);
  if (!d) return;
  const color = d.velocity > 5 ? '#3a7d5c' : d.velocity < -5 ? '#c44b4b' : '#2D3A5C';
  const vSign = d.velocity > 0 ? '+' : '';
  const vClass = d.velocity > 5 ? 'up' : d.velocity < -5 ? 'down' : 'flat';
  document.getElementById('mName').textContent = d.destination;
  document.getElementById('mTrend').innerHTML = `<span class="velocity-badge ${vClass}">${vSign}${d.velocity.toFixed(1)}%</span> <span class="trend-label ${d.trend}">${d.trend === 'rising' ? 'üî• Rising' : d.trend === 'falling' ? 'üìâ Falling' : '‚û°Ô∏è Steady'}</span>`;
  document.getElementById('mChart').innerHTML = bigSparkline(d.values, color);
  document.getElementById('mCurrent').textContent = d.current;
  document.getElementById('mPeak').textContent = d.peak;
  document.getElementById('mChange').innerHTML = `<span style="color:${d.velocity > 5 ? 'var(--green)' : d.velocity < -5 ? 'var(--red)' : 'var(--indigo)'}">${vSign}${d.velocity.toFixed(1)}%</span>`;
  document.getElementById('mDateStart').textContent = d.dates[0] || '';
  document.getElementById('mDateEnd').textContent = d.dates[d.dates.length - 1] || '';
  document.getElementById('mCta').href = `/plan.html?destination=${encodeURIComponent(d.rawName)}`;
  document.getElementById('modal').classList.add('show');
  document.body.style.overflow = 'hidden';
}

function closeModal() {
  document.getElementById('modal').classList.remove('show');
  document.body.style.overflow = '';
}

document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

// Load
fetch('trends-data.json')
  .then(r => r.json())
  .then(data => {
    document.getElementById('updated').textContent = new Date(data.updated).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    allDests = data.destinations.map((d, i) => {
      const velocity = calcVelocity(d.values);
      return {
        rank: i + 1,
        destination: d.country && d.country !== d.destination ? `${d.destination}, ${d.country}` : d.destination,
        rawName: d.destination,
        values: d.values,
        dates: d.dates || [],
        current: d.values[d.values.length - 1] || 0,
        peak: Math.max(...d.values),
        velocity,
        trend: trendClass(velocity),
      };
    });
    allDests.sort((a, b) => b.velocity - a.velocity);
    allDests.forEach((d, i) => d.rank = i + 1);
    document.getElementById('loading').style.display = 'none';
    document.getElementById('table').style.display = 'table';
    document.querySelector('th[data-sort="velocity"] .sort-arrow').textContent = '‚ñº';
    render();
  });
</script>
</body>
</html>
